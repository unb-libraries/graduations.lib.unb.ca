<?php

/**
 * @file
 * Contains pomp_ceremony_node.module
 */

 use Drupal\Component\Serialization\Json;
 use Drupal\Core\Routing\RouteMatchInterface;
 use Drupal\field_collection\Entity\FieldCollectionItem;
 use Drupal\node\Entity\Node;
 use Drupal\views\Views;
 use Drupal\Core\Link;
 use Drupal\Core\Url;

/**
* Implements hook_theme().
*/

function pomp_ceremony_node_theme($existing, $type, $theme, $path) {
  return array(
    'node__honorary_ceremony' => array(
      'arguments' => array(
        'view' => NULL,
        'field' => NULL,
        'row' => NULL,
        'output' => NULL,
      ),
      'template' => 'node--honorary-ceremony',
      'path' => drupal_get_path('module', 'pomp_ceremony_node') . '/templates',
      'base hook' => 'node__honorary_ceremony',
    ),
  );
}

/**
 * Implements hook_preprocess_hook().
 */

function pomp_ceremony_node_preprocess_node__honorary_ceremony(&$variables) {
  $node = $variables['elements']['#node'];
  $variables['id'] = $node->id();

  $year = $node->field_ceremony_year->value;
  $variables['year'] = (string)$year;

  $camp_id = $node->field_list_campus[0]->getValue()['target_id'];
  $variables['campus'] = taxonomy_term_load($camp_id)->getName();

  $type_id = $node->field_list_ceremony_type[0]->getValue()['target_id'];
  $variables['ceremony'] = taxonomy_term_load($type_id)->getName();

  $variables['notes'] = $node->field_ceremony_notes->value;

  $degrees_table = views_embed_view('list_ceremony_degrees', 'block_1', $node->id());
  $variables['degrees_output'] = \Drupal::service('renderer')->render($degrees_table);

  $addresses_table = views_embed_view('list_ceremony_addresses', 'block_1', $node->id());
  $variables['addresses_output'] = \Drupal::service('renderer')->render($addresses_table);
}
